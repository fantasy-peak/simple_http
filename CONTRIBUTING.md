# Contributing Guide

## Running Examples in ./test

### Server

Start the server in one shell:

```sh
xmake run server
```

Make a mTLS request using curl in another shell. Run this in `./test/tls_certificates/` or adjust the paths accordingly.

```sh
curl https://SimpleHttpServer:7788/tls --cacert ca_cert.pem --cert client_cert.pem --key client_key.pem --resolve SimpleHttpServer:7788:0.0.0.0
```

#### Certificate Generation

Certificates in `./test/tls_certificates` were generated by running:

```sh
# root CA
openssl req -x509 -newkey rsa:4096 -keyout ca_key.pem -out ca_cert.pem -sha256 -days 10000 -noenc -subj "/C=SE/CN=RootCA"

# server certificates signed by CA
openssl req -x509 -newkey rsa:4096 -CA ca_cert.pem -CAkey ca_key.pem -keyout server_key.pem -out server_cert.pem -sha256 -days 10000 -noenc -subj "/C=SE/CN=SimpleHttpServer"

# client certificates signed by CA
openssl req -x509 -newkey rsa:4096 -CA ca_cert.pem -CAkey ca_key.pem -keyout client_key.pem -out client_cert.pem -sha256 -days 10000 -noenc -subj "/C=SE/CN=SimpleHttpClient"
```

## Editor Setup

### Generating `compile_commands.json`

These should be generated automatically when running `xmake build`. It's also possible to generate directly by running:

```sh
xmake project -k compile_commands --lsp=clangd build
```

This should create a `./build/compile_commands.json` file.

### Vscode

Developers using `vscode` need to tell their editor where to find the `compile_commands.json`.
Do this by editing `.vscode/c_cpp_properties.json`:

```diff
{
  "configurations": [
    {
      ...
+++   "compileCommands": ["${workspaceFolder}/build/compile_commands.json"]
    }
  ],
  ...
}
```

## Nix Development Environment

Users running Nix with flakes enables may enter a development shell with:

```sh
nix develop
```
